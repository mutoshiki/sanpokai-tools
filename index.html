<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç‡ƒè²»è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>

<style>
/* ---- ã“ã“ã¯å…ƒã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ ---- */
:root {
    --main: #7b9cff;
    --main-dark: #4a6cf7;
    --bg: #f7f8fc;
    --bg-dark: #1e1f25;
    --text: #2a2a2a;
    --text-dark: #e8e8e8;
    --input-bg: #ffffff;
    --input-bg-dark: #2b2d34;
    --card-bg: #ffffff;
    --card-bg-dark: #2d2f36;
    --radius: 16px;
    --shadow: 0 8px 28px rgba(0, 0, 0, 0.12);
}

/* å…±é€š */
body {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(180deg, #ffffff 0%, var(--bg) 100%);
    transition: 0.4s ease;
}
.header {
    background: var(--main);
    padding: 26px;
    text-align: center;
    color: white;
    font-size: 26px;
    font-weight: 700;
    letter-spacing: 1px;
    box-shadow: var(--shadow);
    position: relative;
}

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ */
body.dark { background: var(--bg-dark); color: var(--text-dark); }

body.dark .container { background: var(--card-bg-dark); }
body.dark input { background: var(--input-bg-dark); border-color: #555; color: var(--text-dark); }
body.dark .header { background: var(--main-dark); }
body.dark .result { background: #39405a; border-left-color: #9cb3ff; color: #eaefff; }
body.dark button.main-btn { background: var(--main-dark); }
body.dark label { color: #dcdcdc; }

body.dark .historyItem {
    background: #2e3240;
    border-left-color: #9cb3ff;
    color: #eaefff;
}
body.dark #historyBox { background: #242733; }

/* ã‚·ã‚¹ãƒ†ãƒ è‡ªå‹• */
@media (prefers-color-scheme: dark) {
    body:not(.light) {
        background: var(--bg-dark);
        color: var(--text-dark);
    }
}

/* ãƒ†ãƒ¼ãƒåˆ‡æ›¿ */
.theme-toggle {
    position: absolute;
    right: 22px;
    top: 22px;
    background: rgba(255,255,255,0.3);
    padding: 8px 14px;
    border-radius: 50px;
    cursor: pointer;
    font-size: 14px;
    transition: 0.3s;
    color: #fff;
}
/* çµæœè¡¨ç¤ºãƒœãƒƒã‚¯ã‚¹ï¼ˆãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰æ”¹å–„ç‰ˆï¼‰ */
.result {
    margin-top: 25px;
    padding: 18px 20px;
    background: #eef3ff;            /* å°‘ã—æ¿ƒã„èƒŒæ™¯ */
    border-left: 6px solid var(--main);
    border-radius: 14px;
    color: #1a1a1a !important;       /* æ¿ƒã„æ–‡å­—è‰² */
    font-size: 16px;
    line-height: 1.6;
}

.container {
    max-width: 520px;
    margin: 40px auto;
    padding: 30px;
    background: var(--card-bg);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    transition: 0.4s;
}

label {
    display: block;
    margin-top: 18px;
    font-size: 14px;
    font-weight: 700;
    color: #555;
}

input {
    width: 100%;
    padding: 14px 12px;
    margin-top: 6px;
    border: 1px solid #dcdfea;
    border-radius: var(--radius);
    font-size: 17px;
    transition: 0.25s ease;
    box-sizing: border-box;
}

button.main-btn {
    width: 100%;
    margin-top: 30px;
    padding: 15px;
    background: var(--main);
    color: white;
    border: none;
    font-size: 18px;
    border-radius: 40px;
    cursor: pointer;
}

.historyItem {
    background: #ffffff;
    margin-top: 14px;
    padding: 14px 16px;
    border-radius: 14px;
    border: 1px solid #e0e4f8;
    box-shadow: 0 3px 8px rgba(0,0,0,0.06);
    cursor: pointer;
    transition: 0.25s ease;
    line-height: 1.55;
    color: #222;
}

/* ãƒ›ãƒãƒ¼å‹•ä½œ */
.historyItem:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
}

    
/* ---- å±¥æ­´ UI æ”¹å–„ ---- */
#historyBox {
    margin-top: 40px;
    padding: 20px;
    background: #eef0ff;
    border-radius: 14px;
}

#historyList {
    display: flex;
    flex-direction: column;
    gap: 14px;
    margin-top: 12px;
}

.historyItem {
    width: 100%;
    background: white;
    padding: 14px 16px;
    border-radius: 14px;
    border-left: 6px solid var(--main);
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    cursor: pointer;
    transition: 0.2s;
    line-height: 1.6;
}

.historyItem:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
}

.historyItem b {
    font-size: 15px;
    display: block;
    margin-bottom: 4px;
}

/* å…¥åŠ›ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
.reset-btn {
    width: 100%;
    margin-top: 12px;
    padding: 12px;
    background: #d4d7dd;
    color: #333;
    border: none;
    font-size: 16px;
    border-radius: 14px;
    cursor: pointer;
    transition: 0.2s;
}
.reset-btn:hover {
    background: #c9ccd3;
}

</style>
</head>

<body>

<div class="header">
    ç‡ƒè²»è¨ˆç®—ãƒ„ãƒ¼ãƒ«
    <div class="theme-toggle" onclick="toggleTheme()">ğŸŒ™</div>
</div>

<div class="container">
    <label>èµ°è¡Œè·é›¢ï¼ˆkmï¼‰</label>
    <input type="number" id="distance">

    <label>ç‡ƒè²»ï¼ˆkm/Lï¼‰</label>
    <input type="number" id="fuelEconomy">

    <label>ã‚¬ã‚½ãƒªãƒ³ä¾¡æ ¼ï¼ˆå††/Lï¼‰</label>
    <input type="number" id="gasPrice">

    <label>å‰²ã‚Šå‹˜äººæ•°ï¼ˆä»»æ„ï¼‰</label>
    <input type="number" id="people">

    <label>å¾€å¾©ï¼ˆãƒã‚§ãƒƒã‚¯ã§å¾€å¾©è¨ˆç®—ï¼‰</label>
    <input type="checkbox" id="roundTrip" style="width:auto; margin-top:10px;">

    <button class="main-btn" onclick="calc()">è¨ˆç®—ã™ã‚‹</button>

    <button class="reset-btn" onclick="resetInputs()">å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆ</button>

    <div id="result" class="result" style="display:none; margin-top:20px;"></div>

    <!-- ã‚¬ã‚½ãƒªãƒ³ä»£ã‚³ãƒ”ãƒ¼ -->
    <button id="copyBtn" class="main-btn" style="display:none; margin-top:15px;" onclick="copyCost()">ğŸ“‹ ã‚¬ã‚½ãƒªãƒ³ä»£ã‚’ã‚³ãƒ”ãƒ¼</button>

    <!-- å±¥æ­´ -->
    <div id="historyBox">
        <b style="font-size:17px;">å±¥æ­´ä¸€è¦§</b>
        <div id="historyList"></div>
    </div>
</div>

<footer style="text-align:center; margin:30px 0; opacity:0.6;">
    Â© 2025 Nenpi Calculator
</footer>


<script>
// -------------------------------
// å…¥åŠ›å¾©å…ƒ
// -------------------------------
window.onload = function () {
    ["distance","fuelEconomy","gasPrice","people","roundTrip"].forEach(key=>{
        const v = localStorage.getItem(key);
        if(v !== null){
            if(key === "roundTrip") document.getElementById(key).checked = (v === "true");
            else document.getElementById(key).value = v;
        }
    });

    applyThemeOnLoad();
    loadHistory();
};


// -------------------------------
// å…¥åŠ›ãƒªã‚»ãƒƒãƒˆ
// -------------------------------
function resetInputs() {
    distance.value = "";
    fuelEconomy.value = "";
    gasPrice.value = "";
    people.value = "";
    roundTrip.checked = false;

    result.style.display = "none";
    copyBtn.style.display = "none";

    ["distance","fuelEconomy","gasPrice","people","roundTrip"].forEach(k=>{
        localStorage.removeItem(k);
    });
}


// -------------------------------
// ãƒ†ãƒ¼ãƒåˆ¶å¾¡
// -------------------------------
function applyThemeOnLoad(){
    const saved = localStorage.getItem("theme");

    if(saved){
        document.body.classList.toggle("dark", saved === "dark");
        document.querySelector(".theme-toggle").innerHTML = saved === "dark" ? "â˜€ï¸" : "ğŸŒ™";
        return;
    }

    const hour = new Date().getHours();
    if(hour >= 18 || hour < 6){
        document.body.classList.add("dark");
        document.querySelector(".theme-toggle").innerHTML = "â˜€ï¸";
    } else {
        document.body.classList.remove("dark");
        document.querySelector(".theme-toggle").innerHTML = "ğŸŒ™";
    }
}

function toggleTheme(){
    const nowDark = document.body.classList.toggle("dark");
    document.querySelector(".theme-toggle").innerHTML = nowDark ? "â˜€ï¸" : "ğŸŒ™";
    localStorage.setItem("theme", nowDark ? "dark" : "light");
}


// -------------------------------
// å…¥åŠ›ä¿å­˜
// -------------------------------
function saveInput(){
    ["distance","fuelEconomy","gasPrice","people"].forEach(key=>{
        localStorage.setItem(key, document.getElementById(key).value);
    });
    localStorage.setItem("roundTrip", document.getElementById("roundTrip").checked);
}


// -------------------------------
// è¨ˆç®—
// -------------------------------
let lastCost = 0;

function calc(){
    const d = parseFloat(distance.value);
    const e = parseFloat(fuelEconomy.value);
    const g = parseFloat(gasPrice.value);
    const pe = parseFloat(people.value);
    const round = roundTrip.checked;
    if(isNaN(d)||isNaN(e)||isNaN(g)||d<=0||e<=0||g<=0){
        alert("æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
    }

    const dist = round? d*2 : d;
    const fuel = dist/e;
    const cost = Math.round(fuel*g);
    lastCost = cost;

    let html = `èµ°è¡Œè·é›¢ï¼š${dist} km<br>
                å¿…è¦ã‚¬ã‚½ãƒªãƒ³é‡ï¼š${fuel.toFixed(2)} L<br>
                ã‚¬ã‚½ãƒªãƒ³ä»£ï¼š<strong>${cost} å††</strong>`;

    if(!isNaN(pe) && pe > 0){
        const per = Math.round(cost / pe);
        html += `<br><br>1äººã‚ãŸã‚Šï¼š<strong>${per} å††</strong>`;
    }

    result.style.display = "block";
    result.innerHTML = html;

    copyBtn.style.display = "block";

    saveInput();
    saveHistory(dist,e,g,pe,round,cost);
}


// -------------------------------
// ã‚¬ã‚½ãƒªãƒ³ä»£ã‚³ãƒ”ãƒ¼
// -------------------------------
function copyCost(){
    navigator.clipboard.writeText(String(lastCost));
    alert("ã‚¬ã‚½ãƒªãƒ³ä»£ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
}


// -------------------------------
// å±¥æ­´ä¿å­˜
// -------------------------------
function saveHistory(dist,e,g,pe,round,cost){
    const item = {
        dist,e,g,pe,round,cost,
        time: new Date().toLocaleString()
    };

    let list = JSON.parse(localStorage.getItem("nenpi_history") || "[]");
    list.unshift(item);
    localStorage.setItem("nenpi_history", JSON.stringify(list));

    loadHistory();
}


// -------------------------------
// å±¥æ­´è¡¨ç¤º
// -------------------------------
function loadHistory(){
    const box = document.getElementById("historyList");
    let list = JSON.parse(localStorage.getItem("nenpi_history") || "[]");

    box.innerHTML = "";

    list.forEach(h=>{
        const div = document.createElement("div");
        div.className = "historyItem";
        div.innerHTML = `
            <b>${h.time}</b>
            ${h.dist}km / ${h.e}km/L / ${h.g}å††
        `;

        div.onclick = ()=>restore(h);
        box.appendChild(div);
    });
}


// -------------------------------
// å±¥æ­´ã‹ã‚‰å¾©å…ƒ
// -------------------------------
function restore(h){
    distance.value = h.dist;
    fuelEconomy.value = h.e;
    gasPrice.value = h.g;
    people.value = h.pe;
    roundTrip.checked = h.round;

    calc();
}
</script>

</body>
</html>
